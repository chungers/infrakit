{{/* =% controllerCommit %= */}}

kind: pipeline
metadata:
  name: test1
options:
  ChannelBufferSize : 1024
  # How long to wait before we start the execution of each step, in unit of time (ticks)
  WaitBeforeStart: 2
properties:
  use:
    - url: file://{{env `PWD`}}/docs/controller/pipeline/index.yml
      as: pb
  source:
    parallelism: 2
    from:
      plugin: az1/compute
      select:
        infrakit_collection: az1-compute
    from2:
      - A
      - B
      - C
      - D
      - E
      - F
      - G
      - H
      - I

  steps:
    - call: pb.opA
      params:
        message: this is pb.opA

    - call: pb.opB
    - call: pb.opC
    - call: pb.op1
      params:
        message: this is pb.op1
      resultTemplate: $m := jsonDecode . ; var `x` $m.message  # This will have an error
      resultTemplateVar: x

    - call: pb.op2
      params:
        message: this is pb.op2 ***

    - call: pb.op3
      params:
        message: this is pb.op3
